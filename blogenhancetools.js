function mkUndo(toolName){var undoSelector="#"+toolName+"-submit-undo",textSelector="#"+toolName+"-text";$(undoSelector).click(function(ev){ev.preventDefault();var last=undoStack.pop();$(textSelector).val(last),0==undoStack.length&&$(undoSelector).hide()})}function mkTool(toolName,computeFn,opts){opts=opts||{};var submitSelector="#"+toolName+"-submit",undoSelector="#"+toolName+"-submit-undo",textSelector="#"+toolName+"-text";$(submitSelector).click(function(){var text=$(textSelector).val();if(opts.allowEmptyText||text.length){$("#action-error").hide();try{if(opts.asyncResultFn)computeFn(text,opts.asyncResultFn);else{var result=computeFn(text,opts.asyncResultFn);$(textSelector).val(result)}}catch(err){return void(opts.exceptionFn&&opts.exceptionFn(err))}undoStack.push(text),$(undoSelector).show()}}),mkUndo(toolName)}var undoStack=[];$(function(){function mkImageConvertTool(toolName,inputOpts,outputOpts,computeFn){if(0!=$("#tool-"+toolName).length){var selectedFile,fileSelector="#file-select",submitSelector="#submit";$(fileSelector).on("change",function(ev){$("#action-error").hide();var file=ev.target.files[0];return file.type!=inputOpts.inputMime?($("#action-error").show(),void $("#action-error").text("Selected file is not a "+inputOpts.inputHumanFormat)):(selectedFile=file,void $(submitSelector).attr("disabled",!1))}),$("#drag-and-drop").on("dragover",function(ev){ev.preventDefault(),ev.stopPropagation(),$("#drag-and-drop").addClass("hover")}),$("#drag-and-drop").on("dragenter",function(ev){ev.preventDefault(),ev.stopPropagation(),$("#drag-and-drop").addClass("hover")}),$("#drag-and-drop").on("dragleave",function(ev){ev.preventDefault(),ev.stopPropagation(),$("#drag-and-drop").removeClass("hover")}),$("#drag-and-drop").on("dragend",function(ev){ev.preventDefault(),ev.stopPropagation(),$("#drag-and-drop").removeClass("hover")}),$("#drag-and-drop").on("drop",function(ev){ev.preventDefault(),ev.stopPropagation(),$("#drag-and-drop").removeClass("hover"),$("#action-error").hide(),ev.dataTransfer=ev.originalEvent.dataTransfer;var file=ev.dataTransfer.files[0];return file.type!=inputOpts.inputMime?($("#action-error").show(),void $("#action-error").text("Selected file is not a "+inputOpts.inputHumanFormat)):($("#drag-and-drop-selected").text("Selected "+file.name),selectedFile=file,void $(submitSelector).attr("disabled",!1))}),$(submitSelector).click(function(){var reader=new FileReader;reader.onload=function(){var img=new Image;img.onload=function(){function blobHandler(blob){var lastDot=selectedFile.name.lastIndexOf(".");if(-1!=lastDot)var outputFileName=selectedFile.name.substring(0,lastDot)+"."+outputOpts.outputExt;else var outputFileName=selectedFile.name+"."+optputOpts.outputExt;saveAs(blob,outputFileName)}var canvas=$("<canvas>")[0];canvas.width=img.width,canvas.height=img.height;var canvasCtx=canvas.getContext("2d");canvasCtx.drawImage(img,0,0),canvas.toBlob(blobHandler,outputOpts.outputMime)},img.src=reader.result},reader.readAsDataURL(selectedFile)})}}function jsonToTsv(json){var ret="";if(json instanceof Array){if(json.length){var obj=json[0],keys=Object.keys(obj);if(0==keys.length)for(var i=0;i<json.length;i++){var val=json[i];ret+=val,i!=json.length-1&&(ret+="	")}else{for(var i=0;i<keys.length;i++){var title=keys[i];ret+=title,i!=keys.length-1&&(ret+="	")}ret+="\n";for(var i=0;i<json.length;i++){for(var j=0;j<keys.length;j++){var key=keys[j];ret+=json[i][key],j!=keys.length-1&&(ret+="	")}ret+="\n"}}}}else{for(var keys=Object.keys(json),i=0;i<keys.length;i++){var title=keys[i];ret+=title,i!=keys.length-1&&(ret+="	")}ret+="\n";for(var j=0;j<keys.length;j++){var key=keys[j];ret+=json[key],j!=keys.length-1&&(ret+="	")}ret+="\n"}return ret}function on_scrypt_ready(scrypt){mkTool("scrypt",function(text){var pass=$("#scrypt-pass").val(),salt=$("#scrypt-salt").val(),outputSize=$("#scrypt-output-size").val(),n=$("#scrypt-n").val(),r=$("#scrypt-r").val(),p=$("#scrypt-p").val(),out=scrypt.crypto_scrypt(scrypt.encode_utf8(pass),scrypt.encode_utf8(salt),n,r,p,outputSize);return scrypt.to_hex(out)},{allowEmptyText:!0,exceptionFn:function(err){$("#action-error").show(),$("#action-error").text(err.message)}})}function on_scrypt_ready(scrypt){mkTool("scrypt-check",function(text){for(var lines=text.split("\n"),pass=$("#scrypt-check-pass").val(),salt=$("#scrypt-check-salt").val(),n=($("#scrypt-check-output-size").val(),$("#scrypt-check-n").val()),r=$("#scrypt-check-r").val(),p=$("#scrypt-check-p").val(),ret="",i=0;i<lines.length;i++){var line=lines[i];if(0==line.length)ret+="\n";else{var actualHash=scrypt.crypto_scrypt(scrypt.encode_utf8(pass),scrypt.encode_utf8(salt),n,r,p,line.length/2);actualHash=scrypt.to_hex(actualHash),ret+=actualHash==line?"Valid: "+line+"\n":"Invalid: "+line+"\n"}}return ret},{exceptionFn:function(err){$("#action-error").show(),$("#action-error").text(err)}})}if($("#copy-to-clipboard").click(function(ev){ev.preventDefault(),$("#tool-implementation textarea").select(),document.execCommand("copy")}),mkTool("json-to-tsv",function(text){var parsed=JSON.parse(text);return jsonToTsv(parsed)},{exceptionFn:function(err){$("#action-error").show(),$("#action-error").text(err)}}),mkTool("json-to-xml",function(text){try{var parsed=JSON.parse(text)}catch(err){throw new Error("Invalid JSON")}var converted=vkbeautify.xml(json2xml(parsed));return converted},{exceptionFn:function(err){$("#action-error").show(),$("#action-error").text(err.message)}}),mkTool("yaml-to-xml",function(text){try{var jsonObj=YAML.parse(text)}catch(err){throw new Error("Invalid YAML")}return vkbeautify.xml(json2xml(jsonObj))},{exceptionFn:function(err){$("#action-error").show(),$("#action-error").text(err.message)}}),mkTool("yaml-to-csv",function(text){try{var jsonObj=YAML.parse(text)}catch(err){throw new Error("Invalid YAML")}var converted=json2csv({data:jsonObj});return converted},{exceptionFn:function(err){$("#action-error").show(),$("#action-error").text(err.message)}}),mkTool("json-to-text",function(text){try{var parsed=JSON.parse(text)}catch(err){throw new Error("Invalid JSON")}return jsonToText(parsed)},{exceptionFn:function(err){$("#action-error").show(),$("#action-error").text(err.message)}}),mkTool("json-to-yaml",function(text){try{var parsed=JSON.parse(text)}catch(err){throw new Error("Invalid JSON")}return YAML.stringify(parsed)},{exceptionFn:function(err){$("#action-error").show(),$("#action-error").text(err.message)}}),mkTool("yaml-to-json",function(text){try{var jsonObj=YAML.parse(text)}catch(err){throw new Error("Invalid YAML")}return JSON.stringify(jsonObj,0,2)},{exceptionFn:function(err){$("#action-error").show(),$("#action-error").text(err.message)}}),mkTool("yaml-to-tsv",function(text){try{var jsonObj=YAML.parse(text)}catch(err){throw new Error("Invalid YAML")}return jsonToTsv(jsonObj)},{exceptionFn:function(err){$("#action-error").show(),$("#action-error").text(err.message)}}),mkTool("tsv-extract-column",function(text){var col=$("#tsv-extract-column-number").val();if(!/^\d+$/.test(col))throw new Error("Invalid column number");text=text.replace("\r\n","\n");for(var lines=text.split("\n"),ret="",i=0;i<lines.length;i++){var line=lines[i];if(line.length){var cols=line.split("	");ret+=cols[col-1]+"\n"}else ret+="\n"}return ret},{exceptionFn:function(err){$("#action-error").show(),$("#action-error").text(err.message)}}),mkTool("tsv-delete-column",function(text){var col=$("#tsv-delete-column-number").val();if(!/^\d+$/.test(col))throw new Error("Invalid column number");text=text.replace("\r\n","\n");for(var lines=text.split("\n"),ret="",i=0;i<lines.length;i++){var line=lines[i];if(line.length){var cols=line.split("	");cols.splice(col-1,1),ret+=cols.join("	")+"\n"}else ret+="\n"}return ret},{exceptionFn:function(err){$("#action-error").show(),$("#action-error").text(err.message)}}),mkTool("tsv-replace-column",function(text){var col=$("#tsv-replace-column-number").val();if(!/^\d+$/.test(col))throw new Error("Invalid column number");var newCol=$("#tsv-replace-column-new-column").val();text=text.replace("\r\n","\n");var lines=text.split("\n"),ret="";if(0==newCol.length)for(var i=0;i<lines.length;i++){var line=lines[i],cols=line.split("	");cols.splice(cols-1,1),ret+=cols.join("	")+"\n"}else{var newColLines=newCol.split("\n");if(newColLines.length<lines.length){$("#action-error").show(),$("#action-error").text("The new column has less rows than the existing TSV. Replacing anyway.");for(var i=0;i<lines.length-newColLines.length;i++)newColLines.push("")}newColLines.length>lines.length&&($("#action-error").show(),$("#action-error").text("The new column has more rows than the existing TSV. Replacing anyway."),newColLines.splice(lines.length,newColLines.length));for(var i=0;i<lines.length;i++){var line=lines[i],cols=line.split("	");cols[col-1]=newColLines[i],ret+=cols.join("	")+"\n"}}return ret},{exceptionFn:function(err){$("#action-error").show(),$("#action-error").text(err.message)}}),mkTool("tsv-append-column",function(text){var newCol=$("#tsv-append-column-new-column").val();text=text.replace("\r\n","\n");var lines=text.split("\n"),ret="";if(0==newCol.length)for(var i=0;i<lines.length;i++){var line=lines[i],cols=line.split("	");cols.push(""),ret+=cols.join("	")+"\n"}else{var newColLines=newCol.split("\n");if(newColLines.length<lines.length){$("#action-error").show(),$("#action-error").text("The new column has less rows than the existing TSV. Appending anyway.");for(var i=0;i<lines.length-newColLines.length;i++)newColLines.push("")}newColLines.length>lines.length&&($("#action-error").show(),$("#action-error").text("The new column has more rows than the existing TSV. Appending anyway."),newColLines.splice(lines.length,newColLines.length));for(var i=0;i<lines.length;i++){var line=lines[i],cols=line.split("	");cols.push(newColLines[i]),ret+=cols.join("	")+"\n"}}return ret},{exceptionFn:function(err){$("#action-error").show(),$("#action-error").text(err.message)}}),mkTool("tsv-insert-column",function(text){var col=$("#tsv-insert-column-number").val();if(!/^-?\d+$/.test(col))throw new Error("Invalid column number");var newCol=$("#tsv-insert-column-new-column").val();text=text.replace("\r\n","\n");var lines=text.split("\n"),ret="";if(0==newCol.length)for(var i=0;i<lines.length;i++){var line=lines[i],cols=line.split("	");if(-1==col){var colCount=cols.length;cols.splice(colCount,0,"")}else cols.splice(col-1,0,"");ret+=cols.join("	")+"\n"}else{var newColLines=newCol.split("\n");if(newColLines.length<lines.length){$("#action-error").show(),$("#action-error").text("The new column has less rows than the existing TSV. Inserting anyway.");for(var i=0;i<lines.length-newColLines.length;i++)newColLines.push("")}newColLines.length>lines.length&&($("#action-error").show(),$("#action-error").text("The new column has more rows than the existing TSV. Inserting anyway."),newColLines.splice(lines.length,newColLines.length));for(var i=0;i<lines.length;i++){var line=lines[i],cols=line.split("	");if(-1==col){var colCount=cols.length;cols.splice(colCount,0,newColLines[i])}else cols.splice(col-1,0,newColLines[i]);ret+=cols.join("	")+"\n"}}return ret},{exceptionFn:function(err){$("#action-error").show(),$("#action-error").text(err.message)}}),mkTool("extract-column",function(text){var col=$("#extract-column-number").val(),delim=$("#extract-column-delimiter").val();if(!/^\d+$/.test(col))throw new Error("Invalid column number");text=text.replace("\r\n","\n");for(var lines=text.split("\n"),ret="",i=0;i<lines.length;i++){var line=lines[i];if(line.length){if(" "==delim)var cols=line.split(/\s+/g);else var cols=line.split(delim);ret+=cols[col-1]+"\n"}else ret+="\n"}return ret},{exceptionFn:function(err){$("#action-error").show(),$("#action-error").text(err.message)}}),mkTool("delete-column",function(text){var col=$("#delete-column-number").val(),delim=$("#delete-column-delimiter").val();if(!/^\d+$/.test(col))throw new Error("Invalid column number");text=text.replace("\r\n","\n");for(var lines=text.split("\n"),ret="",i=0;i<lines.length;i++){var line=lines[i];if(line.length){if(" "==delim)var cols=line.split(/\s+/g);else var cols=line.split(delim);cols.splice(col-1,1),ret+=cols.join(delim)+"\n"}else ret+="\n"}return ret},{exceptionFn:function(err){$("#action-error").show(),$("#action-error").text(err.message)}}),mkTool("replace-column",function(text){var col=$("#replace-column-number").val(),delim=$("#replace-column-delimiter").val();if(!/^\d+$/.test(col))throw new Error("Invalid column number");var newCol=$("#replace-column-new-column").val();text=text.replace("\r\n","\n");var lines=text.split("\n"),ret="";if(0==newCol.length)for(var i=0;i<lines.length;i++){var line=lines[i],cols=line.split(delim);cols.splice(cols-1,1),ret+=cols.join(delim)+"\n"}else{var newColLines=newCol.split("\n");if(newColLines.length<lines.length){$("#action-error").show(),$("#action-error").text("The new column has less rows than the existing TSV. Replacing anyway.");for(var i=0;i<lines.length-newColLines.length;i++)newColLines.push("")}newColLines.length>lines.length&&($("#action-error").show(),$("#action-error").text("The new column has more rows than the existing TSV. Replacing anyway."),newColLines.splice(lines.length,newColLines.length));for(var i=0;i<lines.length;i++){var line=lines[i],cols=line.split(delim);cols[col-1]=newColLines[i],ret+=cols.join(delim)+"\n"}}return ret},{exceptionFn:function(err){$("#action-error").show(),$("#action-error").text(err.message)}}),mkTool("swap-columns",function(text){var col1=$("#swap-columns-col1").val(),col2=$("#swap-columns-col2").val(),delim=$("#swap-columns-delimiter").val();if(!/^\d+$/.test(col1))throw new Error("Invalid column 1 number");if(!/^\d+$/.test(col2))throw new Error("Invalid column 2 number");if(col1==col2)throw new Error("Can't swap the same column");text=text.replace("\r\n","\n");for(var lines=text.split("\n"),ret="",i=0;i<lines.length;i++){var line=lines[i];if(line.length){if(" "==delim)var cols=line.split(/\s+/g);else var cols=line.split(delim);var rowCol1=cols[col1-1],rowCol2=cols[col2-1];cols[col1-1]=rowCol2,cols[col2-1]=rowCol1,ret+=cols.join(delim)+"\n"}else ret+="\n"}return ret},{exceptionFn:function(err){$("#action-error").show(),$("#action-error").text(err.message)}}),mkTool("change-delimiter",function(text){text=text.replace("\r\n","\n");for(var lines=text.split("\n"),oldDelim=$("#change-delimiter-old-delimiter").val(),newDelim=$("#change-delimiter-new-delimiter").val(),ret="",i=0;i<lines.length;i++){var line=lines[i];if(" "==oldDelim)var row=line.split(/\s+/g);else var row=line.split(oldDelim);row=row.join(newDelim),ret+=row+"\n"}return ret}),mkTool("csv-columns-to-rows",function(text,asyncResultFn){text=text.replace("\r\n","\n");var lines=text.split("\n");lines.splice(0,0,lines[0]),text=lines.join("\n");var Converter=window.csvtojson.Converter,converter=new Converter({});converter.transform=function(json,row,index){json.rowIndex_xyzzy=index,json.row_xyzzy=row},converter.fromString(text,function(err,result){if(err)throw new Error(err);asyncResultFn(result,text)})},{asyncResultFn:function(json,text){for(var transposedJson=[],i=0;i<json.length;i++)for(var row=json[i].row_xyzzy,j=0;j<row.length;j++)void 0==transposedJson[j]&&(transposedJson[j]=[]),transposedJson[j].push(row[j]);var transposed=json2csv({data:transposedJson}),lines=transposed.split("\n");transposed=lines.slice(1).join("\n"),$("#csv-columns-to-rows-text").val(transposed)},exceptionFn:function(err){$("#action-error").show(),$("#action-error").text(err)}}),mkTool("csv-rows-to-columns",function(text,asyncResultFn){text=text.replace("\r\n","\n");var lines=text.split("\n");lines.splice(0,0,lines[0]),text=lines.join("\n");var Converter=window.csvtojson.Converter,converter=new Converter({});converter.transform=function(json,row,index){json.rowIndex_xyzzy=index,json.row_xyzzy=row},converter.fromString(text,function(err,result){if(err)throw new Error(err);asyncResultFn(result,text)})},{asyncResultFn:function(json,text){for(var transposedJson=[],i=0;i<json.length;i++)for(var row=json[i].row_xyzzy,j=0;j<row.length;j++)void 0==transposedJson[j]&&(transposedJson[j]=[]),transposedJson[j].push(row[j]);var transposed=json2csv({data:transposedJson}),lines=transposed.split("\n");transposed=lines.slice(1).join("\n"),$("#csv-rows-to-columns-text").val(transposed)},exceptionFn:function(err){$("#action-error").show(),$("#action-error").text(err)}}),mkTool("csv-swap-columns",function(text,asyncResultFn){var col1=$("#csv-swap-columns-col1").val();if(!/^\d+$/.test(col1))throw new Error("Invalid column 1 number");var col2=$("#csv-swap-columns-col2").val();if(!/^\d+$/.test(col2))throw new Error("Invalid column 2 number");if(col1==col2)throw new Error("Can't swap the same column");text=text.replace("\r\n","\n");var lines=text.split("\n");lines.splice(0,0,lines[0]),text=lines.join("\n");var Converter=window.csvtojson.Converter,converter=new Converter({});converter.transform=function(json,row,index){json.rowIndex_xyzzy=index,json.row_xyzzy=row},converter.fromString(text,function(err,result){if(err)throw new Error(err);asyncResultFn(result,text,col1,col2)})},{asyncResultFn:function(json,text,col1,col2){var col1Name=json[0].row_xyzzy[col1-1];if(void 0===col1Name){var err="Column "+col1+" doesn't exist";return $("#action-error").show(),void $("#action-error").text(err)}var col2Name=json[0].row_xyzzy[col2-1];if(void 0===col2Name){var err="Column "+col2+" doesn't exist";return $("#action-error").show(),void $("#action-error").text(err)}for(var swappedJson=[],i=0;i<json.length;i++){var row=json[i].row_xyzzy,rowCol1=row[col1-1],rowCol2=row[col2-1];row[col1-1]=rowCol2,row[col2-1]=rowCol1,swappedJson.push(row)}var transposed=json2csv({data:swappedJson}),lines=transposed.split("\n");transposed=lines.slice(1).join("\n"),$("#csv-swap-columns-text").val(transposed)},exceptionFn:function(err){$("#action-error").show(),$("#action-error").text(err)}}),mkTool("csv-replace-column",function(text,asyncResultFn){var col=$("#csv-replace-column-number").val();if(!/^\d+$/.test(col))throw new Error("Invalid column number");var newCol=$("#csv-replace-column-new-column").val();text=text.replace("\r\n","\n");var lines=text.split("\n");lines.splice(0,0,lines[0]),text=lines.join("\n");var Converter=window.csvtojson.Converter,converter=new Converter({});converter.transform=function(json,row,index){json.rowIndex_xyzzy=index,json.row_xyzzy=row},converter.fromString(text,function(err,result){if(err)throw new Error(err);asyncResultFn(result,text,col,newCol)})},{asyncResultFn:function(json,text,col,newCol){var colName=json[0].row_xyzzy[col-1];if(void 0===colName){var err="Column "+col+" doesn't exist";return $("#action-error").show(),void $("#action-error").text(err)}if(0==newCol.length){for(var replacedJson=[],i=0;i<json.length;i++)json[i].row_xyzzy.splice(col-1,1),replacedJson.push(json[i].row_xyzzy);var replaced=json2csv({data:replacedJson}),lines=replaced.split("\n");replaced=lines.slice(1).join("\n"),$("#csv-replace-column-text").val(replaced)}else{var newColLines=newCol.split("\n");if(newColLines.length<json.length){$("#action-error").show(),$("#action-error").text("The new column has less rows than the existing CSV. Replacing anyway.");for(var i=0;i<json.length-newColLines.length;i++)newColLines.push("")}newColLines.length>json.length&&($("#action-error").show(),$("#action-error").text("The new column has more rows than the existing CSV. Replacing anyway."),newColLines.splice(json.length,newColLines.length));for(var replacedJson=[],i=0;i<json.length;i++)json[i].row_xyzzy[col-1]=newColLines[i],replacedJson.push(json[i].row_xyzzy);var replaced=json2csv({data:replacedJson}),lines=replaced.split("\n");replaced=lines.slice(1).join("\n"),$("#csv-replace-column-text").val(replaced)}},exceptionFn:function(err){$("#action-error").show(),$("#action-error").text(err)}}),mkTool("csv-append-column",function(text,asyncResultFn){var newCol=$("#csv-append-column-new-column").val();text=text.replace("\r\n","\n");var lines=text.split("\n");lines.splice(0,0,lines[0]),text=lines.join("\n");var Converter=window.csvtojson.Converter,converter=new Converter({});converter.transform=function(json,row,index){json.rowIndex_xyzzy=index,json.row_xyzzy=row},converter.fromString(text,function(err,result){if(err)throw new Error(err);asyncResultFn(result,text,newCol)})},{asyncResultFn:function(json,text,newCol){var newColLines=newCol.split("\n");if(newColLines.length<json.length){$("#action-error").show(),$("#action-error").text("The new column has less rows than the existing CSV. Appending anyway.");for(var i=0;i<json.length-newColLines.length;i++)newColLines.push("")}newColLines.length>json.length&&($("#action-error").show(),$("#action-error").text("The new column has more rows than the existing CSV. Appending anyway."),newColLines.splice(json.length,newColLines.length));for(var colCount=json[0].row_xyzzy.length,appendedJson=[],i=0;i<json.length;i++)json[i].row_xyzzy[colCount]=newColLines[i],appendedJson.push(json[i].row_xyzzy);var appended=json2csv({data:appendedJson}),lines=appended.split("\n");appended=lines.slice(1).join("\n"),$("#csv-append-column-text").val(appended)},exceptionFn:function(err){$("#action-error").show(),$("#action-error").text(err)}}),mkTool("csv-insert-column",function(text,asyncResultFn){var col=$("#csv-insert-column-number").val();if(!/^-?\d+$/.test(col))throw new Error("Invalid column number");var newCol=$("#csv-insert-column-new-column").val();text=text.replace("\r\n","\n");var lines=text.split("\n");lines.splice(0,0,lines[0]),text=lines.join("\n");var Converter=window.csvtojson.Converter,converter=new Converter({});converter.transform=function(json,row,index){json.rowIndex_xyzzy=index,json.row_xyzzy=row},converter.fromString(text,function(err,result){if(err)throw new Error(err);asyncResultFn(result,text,col,newCol)})},{asyncResultFn:function(json,text,col,newCol){if(0==newCol.length){for(var replacedJson=[],i=0;i<json.length;i++){if(-1==col){var colCount=json[i].row_xyzzy.length;json[i].row_xyzzy.splice(colCount,0,"")}else json[i].row_xyzzy.splice(col-1,0,"");replacedJson.push(json[i].row_xyzzy)}var replaced=json2csv({data:replacedJson}),lines=replaced.split("\n");replaced=lines.slice(1).join("\n"),$("#csv-insert-column-text").val(replaced)}else{var newColLines=newCol.split("\n");if(newColLines.length<json.length){$("#action-error").show(),$("#action-error").text("The new column has less rows than the existing CSV. Inserting anyway.");for(var i=0;i<json.length-newColLines.length;i++)newColLines.push("")}newColLines.length>json.length&&($("#action-error").show(),$("#action-error").text("The new column has more rows than the existing CSV. Inserting anyway."),newColLines.splice(json.length,newColLines.length));for(var replacedJson=[],i=0;i<json.length;i++){if(-1==col){var colCount=json[i].row_xyzzy.length;json[i].row_xyzzy.splice(colCount,0,newColLines[i])}else json[i].row_xyzzy.splice(col-1,0,newColLines[i]);replacedJson.push(json[i].row_xyzzy)}var replaced=json2csv({data:replacedJson}),lines=replaced.split("\n");replaced=lines.slice(1).join("\n"),$("#csv-insert-column-text").val(replaced)}},exceptionFn:function(err){$("#action-error").show(),$("#action-error").text(err)}}),mkTool("csv-change-delimiter",function(text,asyncResultFn){var delim=$("#csv-change-delimiter-new-delimiter").val();text=text.replace("\r\n","\n");var lines=text.split("\n");lines.splice(0,0,lines[0]),text=lines.join("\n");var Converter=window.csvtojson.Converter,converter=new Converter({});converter.fromString(text,function(err,result){if(err)throw new Error(err);asyncResultFn(result,text,delim)})},{asyncResultFn:function(json,text,delim){var newCsv=json2csv({data:json,del:delim}),lines=newCsv.split("\n");newCsv=lines.slice(1).join("\n"),$("#csv-change-delimiter-text").val(newCsv)},exceptionFn:function(err){$("#action-error").show(),$("#action-error").text(err)}}),mkTool("tsv-change-delimiter",function(text){text=text.replace("\r\n","\n");for(var lines=text.split("\n"),delim=$("#tsv-change-delimiter-new-delimiter").val(),ret="",i=0;i<lines.length;i++){var line=lines[i],row=line.split("	");row=row.join(delim),ret+=row+"\n"}return ret}),mkTool("tsv-swap-columns",function(text){var col1=$("#tsv-swap-columns-col1").val();if(!/^\d+$/.test(col1))throw new Error("Invalid column 1 number");var col2=$("#tsv-swap-columns-col2").val();if(!/^\d+$/.test(col2))throw new Error("Invalid column 2 number");if(col1==col2)throw new Error("Can't swap the same column");text=text.replace("\r\n","\n");for(var lines=text.split("\n"),ret="",i=0;i<lines.length;i++){var line=lines[i];if(line.length){var cols=line.split("	"),rowCol1=cols[col1-1],rowCol2=cols[col2-1];cols[col1-1]=rowCol2,cols[col2-1]=rowCol1,ret+=cols.join("	")+"\n"}else ret+="\n"}return ret},{exceptionFn:function(err){$("#action-error").show(),$("#action-error").text(err.message)}}),mkTool("tsv-columns-to-rows",function(text,asyncResultFn){text=text.replace("\r\n","\n");for(var lines=text.split("\n"),transposed=[],i=0;i<lines.length;i++)for(var line=lines[i],row=line.split("	"),j=0;j<row.length;j++)void 0==transposed[j]&&(transposed[j]=[]),transposed[j].push(row[j]);for(var i=0;i<transposed.length;i++)transposed[i]=transposed[i].join("	");return transposed.join("\n")}),mkTool("tsv-rows-to-columns",function(text,asyncResultFn){text=text.replace("\r\n","\n");for(var lines=text.split("\n"),transposed=[],i=0;i<lines.length;i++)for(var line=lines[i],row=line.split("	"),j=0;j<row.length;j++)void 0==transposed[j]&&(transposed[j]=[]),transposed[j].push(row[j]);for(var i=0;i<transposed.length;i++)transposed[i]=transposed[i].join("	");return transposed.join("\n")}),mkTool("text-columns-to-rows",function(text,asyncResultFn){text=text.replace("\r\n","\n");for(var lines=text.split("\n"),delim=$("#text-columns-to-rows-delimiter").val(),transposed=[],i=0;i<lines.length;i++){var line=lines[i];if(" "==delim)var row=line.split(/\s+/g);else var row=line.split(delim);for(var j=0;j<row.length;j++)void 0==transposed[j]&&(transposed[j]=[]),transposed[j].push(row[j])}for(var i=0;i<transposed.length;i++)transposed[i]=transposed[i].join(delim);return transposed.join("\n")}),mkTool("text-rows-to-columns",function(text,asyncResultFn){text=text.replace("\r\n","\n");for(var lines=text.split("\n"),delim=$("#text-rows-to-columns-delimiter").val(),transposed=[],i=0;i<lines.length;i++){var line=lines[i];if(" "==delim)var row=line.split(/\s+/g);else var row=line.split(delim);for(var j=0;j<row.length;j++)void 0==transposed[j]&&(transposed[j]=[]),transposed[j].push(row[j])}for(var i=0;i<transposed.length;i++)transposed[i]=transposed[i].join(delim);return transposed.join("\n")}),mkTool("tsv-transpose",function(text){text=text.replace("\r\n","\n");for(var lines=text.split("\n"),transposed=[],i=0;i<lines.length;i++)for(var line=lines[i],row=line.split("	"),j=0;j<row.length;j++)void 0==transposed[j]&&(transposed[j]=[]),transposed[j].push(row[j]);for(var i=0;i<transposed.length;i++)transposed[i]=transposed[i].join("	");return transposed.join("\n")}),mkTool("text-transpose",function(text){text=text.replace("\r\n","\n");for(var lines=text.split("\n"),delim=$("#text-transpose-delimiter").val(),transposed=[],i=0;i<lines.length;i++){var line=lines[i];if(" "==delim)var row=line.split(/\s+/g);else var row=line.split(delim);for(var j=0;j<row.length;j++)void 0==transposed[j]&&(transposed[j]=[]),transposed[j].push(row[j])}for(var i=0;i<transposed.length;i++)transposed[i]=transposed[i].join(delim);return transposed.join("\n")}),mkTool("xml-prettify",function(text){var converted=vkbeautify.xml(text);return converted}),mkTool("xml-minify",function(text){var converted=vkbeautify.xmlmin(text);return converted}),mkTool("mysql-password",function(text){var x1=CryptoJS.SHA1(text),x2=CryptoJS.SHA1(x1),pass="*"+x2;return pass.toUpperCase()}),mkTool("mariadb-password",function(text){var x1=CryptoJS.SHA1(text),x2=CryptoJS.SHA1(x1),pass="*"+x2;return pass.toUpperCase()}),mkTool("postgres-password",function(text){var username=$("#postgres-username").val();return"md5"+CryptoJS.MD5(text.toString()+username.toString())}),mkTool("bcrypt",function(text,asyncResultFn){var bcrypt=new bCrypt,pass=$("#bcrypt-pass").val(),rounds=$("#bcrypt-rounds").val()||10;bcrypt.hashpw(pass,bcrypt.gensalt(rounds),function(hash){asyncResultFn(hash)})},{allowEmptyText:!0,asyncResultFn:function(result){$("#bcrypt-text").val(result)},exceptionFn:function(err){$("#action-error").show(),$("#action-error").text(err)}}),mkTool("bcrypt-check",function(text,asyncResultFn){for(var lines=text.split("\n"),bcrypt=new bCrypt,pass=$("#bcrypt-check-pass").val(),i=0;i<lines.length;i++){var line=lines[i];0!=line.length&&!function(){var j=i;bcrypt.checkpw(pass,line,function(result){asyncResultFn(line,j,result)})}()}},{asyncResultFn:function(line,lineNr,result){var text=$("#bcrypt-check-text").val(),lines=text.split("\n"),valid=!1;1==result&&(valid=!0),valid?lines[lineNr]="Valid: "+lines[lineNr]:lines[lineNr]="Invalid: "+lines[lineNr],$("#bcrypt-check-text").val(lines.join("\n"))},exceptionFn:function(err){$("#action-error").show(),$("#action-error").text(err)}}),"undefined"!=typeof scrypt_module_factory&&scrypt_module_factory(on_scrypt_ready),"undefined"!=typeof scrypt_module_factory&&scrypt_module_factory(on_scrypt_ready),mkTool("xor-encrypt",function(text){var pass=$("#xor-encrypt-pass").val();if(0==pass.length)throw new Error("empty pass");for(var encrypted="",i=0;i<text.length;i++){var char=text[i].charCodeAt(0),passChar=pass[i%pass.length].charCodeAt(0),encChar=(char^passChar).toString(16);1==encChar.length&&(encChar="0"+encChar),encrypted+=encChar,i!=text.length-1&&(encrypted+="-")}return encrypted},{exceptionFn:function(err){$("#action-error").show(),$("#action-error").text(err)}}),mkTool("xor-decrypt",function(text){var pass=$("#xor-decrypt-pass").val();if(0==pass.length)throw new Error("empty pass");for(var bytes=text.split("-"),decrypted="",i=0;i<bytes.length;i++){var byte=parseInt(bytes[i],16),passChar=pass[i%pass.length].charCodeAt(0),decChar=String.fromCharCode(byte^passChar);decrypted+=decChar}return decrypted},{exceptionFn:function(err){$("#action-error").show(),$("#action-error").text(err)}}),mkTool("aes-encrypt",function(text){var pass=$("#aes-encrypt-pass").val(),encrypted=CryptoJS.AES.encrypt(text,pass);return encrypted}),mkTool("aes-decrypt",function(text){var pass=$("#aes-decrypt-pass").val(),decrypted=CryptoJS.AES.decrypt(text,pass),utf8=CryptoJS.enc.Utf8.stringify(decrypted);return utf8}),mkTool("rc4-encrypt",function(text){var pass=$("#rc4-encrypt-pass").val(),encrypted=CryptoJS.RC4.encrypt(text,pass);return encrypted}),mkTool("rc4-decrypt",function(text){var pass=$("#rc4-decrypt-pass").val(),decrypted=CryptoJS.RC4.decrypt(text,pass),utf8=CryptoJS.enc.Utf8.stringify(decrypted);return utf8}),mkTool("des-encrypt",function(text){var pass=$("#des-encrypt-pass").val(),encrypted=CryptoJS.DES.encrypt(text,pass);return encrypted}),mkTool("des-decrypt",function(text){var pass=$("#des-decrypt-pass").val(),decrypted=CryptoJS.DES.decrypt(text,pass),utf8=CryptoJS.enc.Utf8.stringify(decrypted);return utf8}),mkTool("triple-des-encrypt",function(text){var pass=$("#triple-des-encrypt-pass").val(),encrypted=CryptoJS.TripleDES.encrypt(text,pass);return encrypted}),mkTool("triple-des-decrypt",function(text){var pass=$("#triple-des-decrypt-pass").val(),decrypted=CryptoJS.TripleDES.decrypt(text,pass),utf8=CryptoJS.enc.Utf8.stringify(decrypted);return utf8}),mkTool("rabbit-encrypt",function(text){var pass=$("#rabbit-encrypt-pass").val(),encrypted=CryptoJS.Rabbit.encrypt(text,pass);return encrypted}),mkTool("rabbit-decrypt",function(text){var pass=$("#rabbit-decrypt-pass").val(),decrypted=CryptoJS.Rabbit.decrypt(text,pass),utf8=CryptoJS.enc.Utf8.stringify(decrypted);return utf8}),mkTool("ntlm-hash",function(text){var utf16le=text.split("").join("\x00")+"\x00";return md4(utf16le).toUpperCase()}),mkTool("md2-hash",function(text){return md2(text)},{allowEmptyText:!0}),mkTool("md4-hash",function(text){return md4(text);
},{allowEmptyText:!0}),mkTool("md5-hash",function(text){var hash=CryptoJS.MD5(text);return hash},{allowEmptyText:!0}),mkTool("md6-hash",function(text){var size=parseInt($("#md6-hash-size").val(),10),md6=new md6hash;return md6.hex(text,size)},{allowEmptyText:!0}),mkTool("ripemd128-hash",function(text){return CryptoJS.RIPEMD128(text)},{allowEmptyText:!0}),mkTool("ripemd160-hash",function(text){var hash=CryptoJS.RIPEMD160(text);return hash},{allowEmptyText:!0}),mkTool("ripemd256-hash",function(text){var hash=CryptoJS.RIPEMD256(text);return hash},{allowEmptyText:!0}),mkTool("ripemd320-hash",function(text){var hash=CryptoJS.RIPEMD320(text);return hash},{allowEmptyText:!0}),mkTool("sha1-hash",function(text){var hash=CryptoJS.SHA1(text);return hash},{allowEmptyText:!0}),mkTool("sha2-hash",function(text){var size=parseInt($("#sha2-hash-size").val(),10);if(224==size){var sha224Hash=CryptoJS.SHA224(text);return sha224Hash}if(256==size){var sha256Hash=CryptoJS.SHA256(text);return sha256Hash}if(384==size){var sha384Hash=CryptoJS.SHA384(text);return sha384Hash}if(512==size){var sha512Hash=CryptoJS.SHA512(text);return sha512Hash}return"unknown hash size"},{allowEmptyText:!0}),mkTool("sha3-hash",function(text){var size=parseInt($("#sha3-hash-size").val(),10);if(224==size)var hash=sha3_224(text);else if(256==size)var hash=sha3_256(text);else if(384==size)var hash=sha3_384(text);else if(512==size)var hash=sha3_512(text);return hash},{allowEmptyText:!0}),mkTool("sha224-hash",function(text){var hash=CryptoJS.SHA224(text);return hash},{allowEmptyText:!0}),mkTool("sha256-hash",function(text){var hash=CryptoJS.SHA256(text);return hash},{allowEmptyText:!0}),mkTool("sha384-hash",function(text){var hash=CryptoJS.SHA384(text);return hash},{allowEmptyText:!0}),mkTool("sha512-hash",function(text){var hash=CryptoJS.SHA512(text);return hash},{allowEmptyText:!0}),mkTool("crc16-hash",function(text){return crc16(text)},{allowEmptyText:!0}),mkTool("crc32-hash",function(text){var hash=CRC32.str(text);return(hash>>>0).toString(16)},{allowEmptyText:!0}),mkTool("adler32-hash",function(text){for(var hash=ADLER32.str(text),hashHex=(hash>>>0).toString(16),paddingLength=8-hashHex.length;paddingLength-- >0;)hashHex="0"+hashHex;return hashHex},{allowEmptyText:!0}),mkTool("whirlpool-hash",function(text){var hash=Whirlpool(text);return hash},{allowEmptyText:!0}),mkTool("dec-to-gray",function(text){text=text.replace(/\r\n/g,"\n");for(var lines=text.split("\n"),ret="",i=0;i<lines.length;i++){var line=lines[i];if(line=line.replace(/^\s+/,""),line=line.replace(/\s+$/,""),/(\d+)/.test(line)){for(var num=parseInt(line,10),gray=(num^num>>1).toString(2);gray.length<8;)gray="0"+gray;ret+=gray}ret+="\n"}return ret},{exceptionFn:function(err){$("#action-error").show(),$("#action-error").text(err.message)}}),mkTool("gray-to-dec",function(text){text=text.replace(/\r\n/g,"\n");for(var lines=text.split("\n"),ret="",i=0;i<lines.length;i++){var line=lines[i];if(line=line.replace(/^\s+/,""),line=line.replace(/\s+$/,""),/[01]+/.test(line)){for(var num=parseInt(line,2),mask=num>>1;0!=mask;mask>>=1)num^=mask;ret+=num.toString()}else ret+=line;ret+="\n"}return ret},{exceptionFn:function(err){$("#action-error").show(),$("#action-error").text(err.message)}}),mkTool("bin-to-gray",function(text){text=text.replace(/\r\n/g,"\n");for(var lines=text.split("\n"),ret="",i=0;i<lines.length;i++){var line=lines[i];if(line=line.replace(/^\s+/,""),line=line.replace(/\s+$/,""),/(\d+)/.test(line)){for(var num=parseInt(line,2),gray=(num^num>>1).toString(2);gray.length<8;)gray="0"+gray;ret+=gray}ret+="\n"}return ret},{exceptionFn:function(err){$("#action-error").show(),$("#action-error").text(err.message)}}),mkTool("gray-to-bin",function(text){text=text.replace(/\r\n/g,"\n");for(var lines=text.split("\n"),ret="",i=0;i<lines.length;i++){var line=lines[i];if(line=line.replace(/^\s+/,""),line=line.replace(/\s+$/,""),/[01]+/.test(line)){for(var num=parseInt(line,2),mask=num>>1;0!=mask;mask>>=1)num^=mask;for(var bin=num.toString(2);bin.length<8;)bin="0"+bin;ret+=bin}else ret+=line;ret+="\n"}return ret},{exceptionFn:function(err){$("#action-error").show(),$("#action-error").text(err.message)}}),mkTool("hex-to-gray",function(text){text=text.replace(/\r\n/g,"\n");for(var lines=text.split("\n"),ret="",i=0;i<lines.length;i++){var line=lines[i];if(line=line.replace(/^\s+/,""),line=line.replace(/\s+$/,""),line=line.replace(/^0x/i,""),/[0-9a-f]/i.test(line)){for(var num=parseInt(line,16),gray=(num^num>>1).toString(2);gray.length<8;)gray="0"+gray;ret+=gray}ret+="\n"}return ret},{exceptionFn:function(err){$("#action-error").show(),$("#action-error").text(err.message)}}),mkTool("gray-to-hex",function(text){text=text.replace(/\r\n/g,"\n");for(var lines=text.split("\n"),ret="",i=0;i<lines.length;i++){var line=lines[i];if(line=line.replace(/^\s+/,""),line=line.replace(/\s+$/,""),/[01]+/.test(line)){for(var num=parseInt(line,2),mask=num>>1;0!=mask;mask>>=1)num^=mask;ret+="0x"+num.toString(16)}else ret+=line;ret+="\n"}return ret},{exceptionFn:function(err){$("#action-error").show(),$("#action-error").text(err.message)}}),mkTool("markdown-to-html",function(text){var converter=new showdown.Converter,html=converter.makeHtml(text);return html}),mkTool("text-to-binary",function(text){for(var bytes=[],i=0;i<text.length;i++)for(var realBytes=unescape(encodeURIComponent(text[i])),j=0;j<realBytes.length;j++)bytes.push(realBytes[j].charCodeAt(0));for(var converted="",textToBinFormat=$("#text-to-binary-format-field input").val(),i=0;i<bytes.length;i++){for(var byte=bytes[i],binByte=byte.toString(2),binBytePadded=binByte;binBytePadded.length<8;)binBytePadded="0"+binBytePadded.toString();var char=textToBinFormat;char=char.replace(/%0b/g,binBytePadded),char=char.replace(/%b/g,binByte),converted+=char}return converted}),$("#text-to-binary-format").click(function(ev){ev.preventDefault(),$("#text-to-binary-format-field").slideToggle()}),mkTool("binary-to-text",function(text){text=text.replace(/\s+/g," "),bytes=text.split(" ");for(var i=0;i<bytes.length;i++)if(bytes[i].length<8)for(var j=bytes[i].length;8!=j;j++)bytes[i]="0"+bytes[i];if(text=bytes.join(""),text.length%8!=0)throw new Error("Input binary doesnt split into groups of 8 bits evenly.");for(var ret="",i=0;i<text.length;i+=8)ret+=String.fromCharCode(parseInt(text.substr(i,8),2));return ret},{exceptionFn:function(err){$("#action-error").show(),$("#action-error").text(err.message)}}),mkTool("text-to-octal",function(text){for(var bytes=[],i=0;i<text.length;i++)for(var realBytes=unescape(encodeURIComponent(text[i])),j=0;j<realBytes.length;j++)bytes.push(realBytes[j].charCodeAt(0));for(var converted="",textToOctFormat=$("#text-to-octal-format-field input").val(),i=0;i<bytes.length;i++){var byte=bytes[i],octByte=byte.toString(8),char=textToOctFormat;char=char.replace(/%o/g,octByte),converted+=char}return converted}),$("#text-to-octal-format").click(function(ev){ev.preventDefault(),$("#text-to-octal-format-field").slideToggle()}),mkTool("octal-to-text",function(text){text=text.replace(/\s+/g," "),bytes=text.split(" ");for(var i=0;i<bytes.length;i++)if(bytes[i].length<3)for(var j=bytes[i].length;3!=j;j++)bytes[i]="0"+bytes[i];if(text=bytes.join(""),text.length%3!=0)throw new Error("Input octal doesnt split into groups of 3 digits evenly.");for(var ret="",i=0;i<text.length;i+=3)ret+=String.fromCharCode(parseInt(text.substr(i,3),8));return ret},{exceptionFn:function(err){$("#action-error").show(),$("#action-error").text(err.message)}}),mkTool("text-to-ascii",function(text){for(var bytes=[],i=0;i<text.length;i++)for(var realBytes=unescape(encodeURIComponent(text[i])),j=0;j<realBytes.length;j++)bytes.push(realBytes[j].charCodeAt(0));for(var converted="",textToDecFormat="%d ",i=0;i<bytes.length;i++){var byte=bytes[i],decByte=byte.toString(10),char=textToDecFormat;char=char.replace(/%d/g,decByte),converted+=char}return converted}),mkTool("ascii-to-text",function(text){text=text.replace(/\s+/g," "),bytes=text.split(" ");for(var ret="",i=0;i<bytes.length;i++)ret+=String.fromCharCode(bytes[i]);return ret},{exceptionFn:function(err){$("#action-error").show(),$("#action-error").text(err.message)}}),$("#text-to-decimal-format").click(function(ev){ev.preventDefault(),$("#text-to-decimal-format-field").slideToggle()}),mkTool("text-to-decimal",function(text){for(var bytes=[],i=0;i<text.length;i++)for(var realBytes=unescape(encodeURIComponent(text[i])),j=0;j<realBytes.length;j++)bytes.push(realBytes[j].charCodeAt(0));for(var converted="",textToDecFormat=$("#text-to-decimal-format-field input").val(),i=0;i<bytes.length;i++){var byte=bytes[i],decByte=byte.toString(10),char=textToDecFormat;char=char.replace(/%d/g,decByte),converted+=char}return converted}),mkTool("decimal-to-text",function(text){text=text.replace(/\s+/g," "),bytes=text.split(" ");for(var ret="",i=0;i<bytes.length;i++)ret+=String.fromCharCode(bytes[i]);return ret},{exceptionFn:function(err){$("#action-error").show(),$("#action-error").text(err.message)}}),mkTool("text-to-hex",function(text){for(var bytes=[],i=0;i<text.length;i++)for(var realBytes=unescape(encodeURIComponent(text[i])),j=0;j<realBytes.length;j++)bytes.push(realBytes[j].charCodeAt(0));for(var converted="",textToHexFormat=$("#text-to-hex-format-field input").val(),i=0;i<bytes.length;i++){var byte=bytes[i],hexByte=byte.toString(16);1==hexByte.length&&(hexByte="0"+hexByte);var char=textToHexFormat;char=char.replace(/%x/g,hexByte),converted+=char}return converted}),$("#text-to-hex-format").click(function(ev){ev.preventDefault(),$("#text-to-hex-format-field").slideToggle()}),mkTool("hex-to-text",function(text){text=text.replace(/0x/g,""),text=text.replace(/\s+/g," "),bytes=text.split(" ");for(var i=0;i<bytes.length;i++)1==bytes[i].length&&(bytes[i]="0"+bytes[i]);if(text=bytes.join(""),text.length%2!=0)throw new Error("Uneven number of hex characters.");for(var ret="",i=0;i<text.length;i+=2)ret+=String.fromCharCode(parseInt(text.substr(i,2),16));return ret},{exceptionFn:function(err){$("#action-error").show(),$("#action-error").text(err.message)}}),mkTool("text-lowercase",function(text){for(var ret="",i=0;i<text.length;i++)ret+=text[i].toLowerCase();return ret}),mkTool("text-uppercase",function(text){for(var ret="",i=0;i<text.length;i++)ret+=text[i].toUpperCase();return ret}),mkTool("text-titlecase",function(text){return text=text.toLowerCase(),titleCase(text)}),mkTool("text-capitalize",function(text){text=text.replace(/\r\n/,"\n");for(var lines=text.split("\n"),i=0;i<lines.length;i++){for(var line=lines[i],words=line.split(" "),j=0;j<words.length;j++)words[j]=words[j].charAt(0).toUpperCase()+words[j].substring(1);lines[i]=words.join(" ")}return lines.join("\n")}),mkTool("text-invert-case",function(text){for(var ret="",i=0;i<text.length;i++){var isLower=text[i].toLowerCase()==text[i];ret+=isLower?text[i].toUpperCase():text[i].toLowerCase()}return ret}),mkTool("text-randomcase",function(text){for(var ret="",i=0;i<text.length;i++){var char=text[i].toLowerCase();ret+=Math.random()<.5?char:char.toUpperCase()}return ret}),mkTool("spaces-to-tabs",function(text){var spaceCount=$("#spaces-to-tabs-count").val(),rx=new RegExp(" {"+spaceCount+"}","g");return text.replace(rx,"	")}),mkTool("tabs-to-spaces",function(text){for(var spaceCount=$("#tabs-to-spaces-count").val(),spaceStr="",i=1;spaceCount>=i;i++)spaceStr+=" ";return text.replace(/\t/g,spaceStr)}),mkTool("spaces-to-newlines",function(text){return text.replace(/\s+/g,"\n")}),mkTool("newlines-to-spaces",function(text){text=text.replace(/\r\n/g,"\n");for(var lines=text.split("\n"),retLines=[],i=0;i<lines.length;i++)/\w/.test(lines[i])&&retLines.push(lines[i]);return retLines.join(" ")}),mkTool("add-slashes",function(text){return text=text.replace(/\\/g,"\\\\"),text=text.replace(/\t/g,"\\t"),text=text.replace(/\n/g,"\\n"),text=text.replace(/'/g,"\\'"),text=text.replace(/"/g,'\\"')}),mkTool("strip-slashes",function(text){return text.replace(/\\(.?)/g,function(match,char){return"\\"==char?"\\":"t"==char?"	":"n"==char?"\n":""==char?"":char})}),mkTool("remove-accents",function(text){return text=removeAccents(text)}),mkTool("remove-whitespace",function(text){return text=text.replace(/ +/g," "),text=text.replace(/\t+/g," "),text=text.replace(/^\s+/g,""),text=text.replace(/\s+$/g,"")}),mkTool("remove-all-whitespace",function(text){return text=text.replace(/\s+/g,"")}),mkTool("remove-punctuation",function(text){var puntuationRe=/[\u2000-\u206F\u2E00-\u2E7F\\'!"#$%&()*+,\-.\/:;<=>?@\[\]^_`{|}~]/g;return text=text.replace(puntuationRe,"")}),mkTool("text-repeat",function(text){for(var count=$("#text-repeat-count").val(),ret="",i=1;count>=i;i++)ret+=text;return ret}),mkTool("text-right-align",function(text){for(var lines=text.split("\n"),longestLine=0,i=0;i<lines.length;i++)lines[i].length>longestLine&&(longestLine=lines[i].length);ret="";for(var i=0;i<lines.length;i++){for(var line=lines[i],padLength=longestLine-line.length,newLine=line,j=0;padLength>j;j++)newLine=" "+newLine.toString();ret+=newLine+"\n"}return ret}),mkTool("text-left-pad",function(text){var width=$("#text-left-pad-width").val(),symbol=$("#text-left-pad-symbol").val(),lines=text.split("\n");ret="";for(var i=0;i<lines.length;i++){var line=lines[i];if(line.length>=width)ret+=line;else{for(var padLength=width-line.length,newLine=line,j=0;padLength>j;j++)newLine=symbol.toString()+newLine.toString();ret+=newLine}ret+="\n"}return ret}),mkTool("text-right-pad",function(text){var width=$("#text-right-pad-width").val(),symbol=$("#text-right-pad-symbol").val(),lines=text.split("\n");ret="";for(var i=0;i<lines.length;i++){var line=lines[i];if(line.length>=width)ret+=line;else{for(var padLength=width-line.length,newLine=line,j=0;padLength>j;j++)newLine+=symbol.toString();ret+=newLine}ret+="\n"}return ret}),mkTool("text-replace",function(text){var replaceFrom=$("#text-replace-from").val(),replaceTo=$("#text-replace-to").val();return"\\n"==replaceTo?replaceTo="\n":"\\t"==replaceTo&&(replaceTo="	"),text.split(replaceFrom).join(replaceTo)}),mkTool("text-reverse",function(text){return text.split("").reverse().join("")}),mkTool("text-length",function(text){return text.length}),mkTool("text-truncate",function(text){var lines=text.split("\n"),truncateLength=$("#text-truncate-length").val();ret="";for(var i=0;i<lines.length;i++){var line=lines[i];line.length>truncateLength&&(line=line.substr(0,truncateLength)),ret+=line+"\n"}return ret}),mkTool("text-trim",function(text){var lines=text.split("\n");ret="";for(var i=0;i<lines.length;i++){var line=lines[i];line=line.replace(/^\s+/g,""),line=line.replace(/\s+$/g,""),ret+=line+"\n"}return ret}),mkTool("merge-lists",function(text){for(var list1=text.split("\n"),list2=$("#merge-lists-text2").val().split("\n"),delim=$("#merge-lists-delimiter").val(),ret="",i=0;i<list1.length;i++){var el1=list1[i],el2=list2[i];if(void 0===el2)break;ret+=el1+""+delim+el2+"\n"}return ret}),mkTool("zip-lists",function(text){for(var list1=text.split("\n"),list2=$("#zip-lists-text2").val().split("\n"),ret="",i=0;i<list1.length;i++){var el1=list1[i],el2=list2[i];if(void 0===el2)break;ret+=el1+"\n",ret+=el2+"\n"}return ret}),mkTool("common-elements",function(text){for(var list1=text.split("\n"),list2=$("#common-elements-text2").val().split("\n"),list1Hash={},i=0;i<list1.length;i++){var el1=list1[i];list1Hash[el1]=1}for(var ret="",i=0;i<list2.length;i++){var el2=list2[i];void 0!==list1Hash[el2]&&(ret+=el2+"\n")}return $("#common-elements-text2").val(""),ret}),mkTool("distinct-elements",function(text){for(var list1=text.split("\n"),list2=$("#distinct-elements-text2").val().split("\n"),list1Hash={},i=0;i<list1.length;i++){var el1=list1[i];list1Hash[el1]=1}for(var list2Hash={},i=0;i<list2.length;i++){var el2=list2[i];list2Hash[el2]=1}for(var ret="",i=0;i<list1.length;i++){var el1=list1[i];void 0===list1Hash[el1]&&void 0!==list2Hash[el1]?ret+=el1+"\n":void 0!==list1Hash[el1]&&void 0===list2Hash[el1]&&(ret+=el1+"\n")}for(var i=0;i<list2.length;i++){var el2=list2[i];void 0===list1Hash[el2]&&void 0!==list2Hash[el2]?ret+=el2+"\n":void 0!==list1Hash[el2]&&void 0===list2Hash[el2]&&(ret+=el2+"\n")}return $("#distinct-elements-text2").val(""),ret}),mkTool("grep",function(text){var regex=$("#grep-regex").val(),invertMatches=$("#grep-invert").is(":checked"),regexParts=regex.match(/^\/(.*?)\/([gimuy]*)$/);if(regexParts)var r=new RegExp(regexParts[1],regexParts[2]);else var r=new RegExp(regex);text=text.replace(/\r\n/g,"\n");for(var lines=text.split("\n"),ret="",i=0;i<lines.length;i++){var line=lines[i];invertMatches?r.test(line)||(ret+=line+"\n"):r.test(line)&&(ret+=line+"\n")}return ret}),mkTool("head",function(text){var howMany=$("#head-how-many").val();text=text.replace(/\r\n/g,"\n");for(var lines=text.split("\n"),ret="",i=0;howMany>i&&!(i>=lines.length);i++)ret+=lines[i]+"\n";return ret}),mkTool("tail",function(text){var howMany=$("#tail-how-many").val();text=text.replace(/\r\n/g,"\n");var lines=text.split("\n");lines=lines.reverse();for(var ret=[],i=0;howMany>i&&!(i>=lines.length);i++)ret.push(lines[i]);return ret=ret.reverse(),ret.join("\n")}),mkTool("extract-lines",function(text){var start=$("#extract-lines-start").val(),end=$("#extract-lines-end").val();text=text.replace(/\r\n/g,"\n");for(var lines=text.split("\n"),ret="",i=start-1;end-1>=i&&!(i>=lines.length);i++)ret+=lines[i]+"\n";return ret}),mkTool("letter-count",function(text){return text.length}),$("#number-lines-format").click(function(ev){ev.preventDefault(),$("#number-lines-field").slideToggle()}),mkTool("number-lines",function(text){text=text.replace(/\r\n/g,"\n");for(var lines=text.split("\n"),ret="",format=$('#number-lines-field input[name="format"]').val(),i=0;i<lines.length;i++){var line=lines[i],formatStr=format.replace("NR",i+1);ret+=formatStr+line+"\n"}return ret}),mkTool("prefix-lines",function(text){text=text.replace(/\r\n/g,"\n");for(var lines=text.split("\n"),ret="",prefix=$('#prefix-lines-field input[name="prefix"]').val(),i=0;i<lines.length;i++){var line=lines[i];ret+=prefix+line+"\n"}return ret}),mkTool("suffix-lines",function(text){text=text.replace(/\r\n/g,"\n");for(var lines=text.split("\n"),ret="",suffix=$('#suffix-lines-field input[name="suffix"]').val(),i=0;i<lines.length;i++){var line=lines[i];ret+=line+suffix+"\n"}return ret}),mkTool("prefix-suffix-lines",function(text){text=text.replace(/\r\n/g,"\n");for(var lines=text.split("\n"),ret="",prefix=$('#prefix-suffix-lines-field input[name="prefix"]').val(),suffix=$('#prefix-suffix-lines-field input[name="suffix"]').val(),i=0;i<lines.length;i++){var line=lines[i];ret+=prefix+line+suffix+"\n"}return ret}),mkTool("longest-line",function(text){text=text.replace(/\r\n/g,"\n");for(var lines=text.split("\n"),ret="",i=0;i<lines.length;i++){var line=lines[i];line.length>ret.length&&(ret=line)}return ret}),mkTool("shortest-line",function(text){text=text.replace(/\r\n/g,"\n");for(var lines=text.split("\n"),ret="",currLen=-1,i=0;i<lines.length;i++){var line=lines[i];line.length&&(-1==currLen||line.length<ret.length)&&(ret=line,currLen=line.length)}return ret}),mkTool("duplicate-lines",function(text){text=text.replace(/\r\n/g,"\n");for(var lines=text.split("\n"),seen={},ret="",i=0;i<lines.length;i++){var line=lines[i];seen[line]||(seen[line]=1,ret+=line+"\n")}return ret}),mkTool("empty-lines",function(text){text=text.replace(/\r\n/g,"\n");for(var lines=text.split("\n"),ret="",i=0;i<lines.length;i++){var line=lines[i];/^[\s\t]*$/.test(line)||(ret+=line+"\n")}return ret}),mkTool("random-lines",function(text){function KnuthShuffle(array){for(var temporaryValue,randomIndex,currentIndex=array.length;0!==currentIndex;)randomIndex=Math.floor(Math.random()*currentIndex),currentIndex-=1,temporaryValue=array[currentIndex],array[currentIndex]=array[randomIndex],array[randomIndex]=temporaryValue;return array}text=text.replace(/\r\n/g,"\n");var lines=text.split("\n");return lines=KnuthShuffle(lines),lines.join("\n")}),mkTool("random-letters",function(text){function KnuthShuffle(array){for(var temporaryValue,randomIndex,currentIndex=array.length;0!==currentIndex;)randomIndex=Math.floor(Math.random()*currentIndex),currentIndex-=1,temporaryValue=array[currentIndex],array[currentIndex]=array[randomIndex],array[randomIndex]=temporaryValue;return array}text=text.replace(/\r\n/g,"\n");var letters=text.split("");return letters=KnuthShuffle(letters),letters.join("")}),mkTool("join-lines",function(text){text=text.replace(/\r\n/g,"\n");for(var lines=text.split("\n"),retLines=[],symbol=$("#join-lines-symbol").val(),i=0;i<lines.length;i++)/\w/.test(lines[i])&&retLines.push(lines[i]);return retLines.join(symbol)}),mkTool("filter-lines",function(text){text=text.replace(/\r\n/g,"\n");for(var lines=text.split("\n"),ret="",pattern=$("#filter-lines-pattern").val(),invertMatches=$("#filter-lines-invert").is(":checked"),i=0;i<lines.length;i++)invertMatches?lines[i].indexOf(pattern)>=0||(ret+=lines[i]+"\n"):lines[i].indexOf(pattern)>=0&&(ret+=lines[i]+"\n");return ret}),mkTool("text-split",function(text){var symbol=$("#text-split-symbol").val(),parts=text.split(symbol);return parts.join("\n")}),mkTool("reverse-lines",function(text){text=text.replace(/\r\n/g,"\n");var lines=text.split("\n");return lines.reverse(),lines.join("\n")}),mkTool("text-sort",function(text){text=text.replace(/\r\n/g,"\n");var lines=text.split("\n");return lines.sort(),lines.join("\n")}),mkTool("numeric-sort",function(text){text=text.replace(/\r\n/g,"\n");var lines=text.split("\n");return lines.sort(function(a,b){return parseInt(a,10)-parseInt(b,10)}),lines.join("\n")}),mkTool("word-sort",function(text){text=text.replace(/[?.,!"]/g," "),text=text.replace(/\s+$/g,""),text=text.replace(/^\s+/g,"");var words=text.split(/\s+/);return words.sort(function(a,b){return a.toLowerCase()<b.toLowerCase()?-1:a.toLowerCase()>b.toLowerCase()?1:0}),words.join(" ")}),mkTool("line-length-sort",function(text){text=text.replace(/\r\n/g,"\n");var lines=text.split("\n"),format=$("#line-length-sort-format").val();return lines.sort(function(a,b){return"s2l"==format?a.length-b.length:b.length-a.length}),lines.join("\n")}),mkTool("ip-sort",function(text){text=text.replace(/\r\n/g,"\n");var ips=text.split("\n");return ips.sort(function(a,b){var ip1=a.split("."),ip2=b.split("."),compa=256*parseInt(ip1[0],10)*256*256+256*parseInt(ip1[1],10)*256+256*parseInt(ip1[2],10)+parseInt(ip1[3],10),compb=256*parseInt(ip2[0],10)*256*256+256*parseInt(ip2[1],10)*256+256*parseInt(ip2[2],10)+parseInt(ip2[3],10);return compa-compb}),ips.join("\n")}),mkTool("word-wrap",function(text){var len=$("#word-wrap-length").val(),ww=wordwrap(len);return ww(text)}),mkTool("word-split",function(text){var parts=text.split(/\s+/g);return parts.join("\n")}),mkTool("word-count",function(text){return text.match(/\S+/g).length}),mkTool("line-count",function(text){return text.split("\n").length}),mkTool("paragraph-count",function(text){for(var paragraphs=text.split(/\n\n+/g),paragraphCount=0,i=0;i<paragraphs.length;i++)0!=paragraphs[i].length&&paragraphCount++;return paragraphCount}),mkTool("text-from-regex",function(text){for(var howMany=parseInt($("#text-from-regex-how-many").val(),10),regex=$("#text-from-regex-regex").val(),ret="",i=1;howMany>=i;i++){var r=new RandExp(regex);ret+=r.gen(),ret+="\n"}return ret},{allowEmptyText:!0,exceptionFn:function(err){$("#action-error").show(),$("#action-error").text(err)}}),mkTool("regex-replace",function(text){var regex=$("#regex-replace-regex").val(),regexParts=regex.match(/^\/(.*?)\/([gimuy]*)$/);if(regexParts)var r=new RegExp(regexParts[1],regexParts[2]);else var r=new RegExp(regex);var replaceTo=$("#regex-replace-to").val();return text=text.replace(r,replaceTo)},{exceptionFn:function(err){$("#action-error").show(),$("#action-error").text(err)}}),mkTool("regex-extract-matches",function(text){var regex=$("#regex-extract-matches-regex").val(),regexParts=regex.match(/^\/(.*?)\/([gimuy]*)$/);if(regexParts)var r=new RegExp(regexParts[1],regexParts[2]);else var r=new RegExp(regex);var matches=text.match(r),ret="";if(matches)for(var i=0;i<matches.length;i++)ret+=matches[i],ret+="\n";return ret},{exceptionFn:function(err){$("#action-error").show(),$("#action-error").text(err)}}),mkTool("extract-emails",function(text){var matches=text.match(/[a-z0-9._%+-]+@[a-z0-9-]+\.([a-z0-9]+)/gi),ret="";if(matches)for(var i=0;i<matches.length;i++)ret+=matches[i],ret+="\n";return ret}),mkTool("extract-urls",function(text){var urlRegex=new RegExp("(?:(?:https?|ftp)://)(?:\\S+(?::\\S*)?@)?(?:(?!(?:10|127)(?:\\.\\d{1,3}){3})(?!(?:169\\.254|192\\.168)(?:\\.\\d{1,3}){2})(?!172\\.(?:1[6-9]|2\\d|3[0-1])(?:\\.\\d{1,3}){2})(?:[1-9]\\d?|1\\d\\d|2[01]\\d|22[0-3])(?:\\.(?:1?\\d{1,2}|2[0-4]\\d|25[0-5])){2}(?:\\.(?:[1-9]\\d?|1\\d\\d|2[0-4]\\d|25[0-4]))|(?:(?:[a-z\\u00a1-\\uffff0-9]-*)*[a-z\\u00a1-\\uffff0-9]+)(?:\\.(?:[a-z\\u00a1-\\uffff0-9]-*)*[a-z\\u00a1-\\uffff0-9]+)*(?:\\.(?:[a-z\\u00a1-\\uffff]{2,}))\\.?)(?::\\d{2,5})?(?:[/?#]\\S*)?","gi"),matches=text.match(urlRegex),ret="";if(matches)for(var i=0;i<matches.length;i++)ret+=matches[i],ret+="\n";return ret},{exceptionFn:function(err){$("#action-error").show(),$("#action-error").text(err)}}),mkTool("extract-numbers",function(text){var matches=text.match(/-?[0-9](\.[0-9]+)?/gi),ret="";if(matches)for(var i=0;i<matches.length;i++)ret+=matches[i],ret+="\n";return ret},{exceptionFn:function(err){$("#action-error").show(),$("#action-error").text(err)}}),mkTool("text-info",function(text){for(var length=text.length,wordCount=text.match(/\S+/g).length,lineCount=text.split("\n").length,paragraphs=text.split(/\n\n+/g),paragraphCount=0,i=0;i<paragraphs.length;i++)0!=paragraphs[i].length&&paragraphCount++;for(var textSentences=text.split(/[.?!]+/),sentenceCount=0,i=0;i<textSentences.length;i++)/\w/.test(textSentences[i])&&sentenceCount++;for(var charStats={},wordStats={},asciiCount=0,extendedAsciiCount=0,unicodeCount=0,chars=text.split(""),i=0;i<chars.length;i++){var char=chars[i];void 0===charStats[char]?charStats[char]=1:charStats[char]++;var charCode=char.charCodeAt(0);charCode>=0&&127>=charCode?asciiCount++:charCode>127&&255>=charCode?extendedAsciiCount++:unicodeCount++}for(var words=text.split(/\s+/g),i=0;i<words.length;i++){var word=words[i].toLowerCase();word=word.replace(/[,.?!]+/,""),word.length&&(void 0===wordStats[word]?wordStats[word]=1:wordStats[word]++)}for(var retText="Text statistics:\nLength:      "+length+"\nWords:       "+wordCount+"\nSentences:   "+sentenceCount+"\nLines:       "+lineCount+"\nParagraphs:  "+paragraphCount+"\n\nAscii Characters (0-127):            "+asciiCount+"\nExtended Ascii Characters (127-255): "+extendedAsciiCount+"\nAll Ascii Characters (0-255):        "+(extendedAsciiCount+asciiCount)+"\nUnicode Characters (255+):           "+unicodeCount+"\n\nWord statistics:\n",sortedWordStatsKeys=Object.keys(wordStats).sort(function(a,b){return wordStats[b]-wordStats[a]}),i=0;i<sortedWordStatsKeys.length;i++){var key=sortedWordStatsKeys[i];retText+=key+": "+wordStats[key]+"\n"}retText+="\nCharacter statistics:\n";for(var sortedCharStatsKeys=Object.keys(charStats).sort(function(a,b){return charStats[b]-charStats[a]}),i=0;i<sortedCharStatsKeys.length;i++){var key=sortedCharStatsKeys[i],strKey=key;"10"==key.charCodeAt(0)?strKey="":"32"==key.charCodeAt(0)&&(strKey=""),retText+=strKey+": "+charStats[key]+"\n"}return retText}),mkTool("random-pick",function(text){for(var lines=text.split("\n"),howMany=parseInt($("#random-pick-how-many").val(),10),ret=[],i=0;howMany>i;i++){var itemIndex=parseInt(Math.random()*lines.length,10);ret.push(lines[itemIndex]),lines.splice(itemIndex,1)}return ret.join("\n")}),$("#random-string-format").change(function(){var format=$("#random-string-format").val();"custom"==format?$("#random-string-custom-format").slideDown():$("#random-string-custom-format").slideUp()}),mkTool("random-string",function(){var len=$("#random-string-length").val(),format=$("#random-string-format").val(),possibleAlphaLc="abcdefghijklmnopqrstuvwxyz",possibleAlphaUc="ABCDEFGHIJKLMNOPQRSTUVWXYZ",possibleAlphaMix="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ",possibleAlphaLcNum="abcdefghijklmnopqrstuvwxyz0123456789",possibleAlphaUcNum="ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789",possibleAlphaMixNum="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789",possibleNum="0123456789";if("custom"==format){var customFormat=$("#random-string-custom-format input").val();if(0==customFormat.length)return""}for(var str="",i=0;len>i;i++)if("alphalc"==format){var char=possibleAlphaLc.charAt(Math.random()*possibleAlphaLc.length);str+=char}else if("alphauc"==format){var char=possibleAlphaUc.charAt(Math.random()*possibleAlphaUc.length);str+=char}else if("alphamix"==format){var char=possibleAlphaMix.charAt(Math.random()*possibleAlphaMix.length);str+=char}else if("alphalcnum"==format){var char=possibleAlphaLcNum.charAt(Math.random()*possibleAlphaLcNum.length);str+=char}else if("alphaucnum"==format){var char=possibleAlphaUcNum.charAt(Math.random()*possibleAlphaUcNum.length);str+=char}else if("alphamixnum"==format){var char=possibleAlphaMixNum.charAt(Math.random()*possibleAlphaMixNum.length);str+=char}else if("num"==format){var char=possibleNum.charAt(Math.random()*possibleNum.length);str+=char}else if("custom"==format){var char=customFormat.charAt(Math.random()*customFormat.length);str+=char}return str},{allowEmptyText:!0}),$("#random-password-format").change(function(){var format=$("#random-password-format").val();"custom"==format?$("#random-password-custom-format").slideDown():$("#random-password-custom-format").slideUp()}),mkTool("random-password",function(){var format=$("#random-password-format").val(),len=$("#random-password-length").val(),count=$("#random-password-count").val(),possibleAlphaLc="abcdefghijklmnopqrstuvwxyz",possibleAlphaUc="ABCDEFGHIJKLMNOPQRSTUVWXYZ",possibleAlphaMix="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ",possibleAlphaLcNum="abcdefghijklmnopqrstuvwxyz0123456789",possibleAlphaUcNum="ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789",possibleAlphaMixNum="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789",possibleBase58="123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz",possibleNum="0123456789";if("custom"==format){var customFormat=$("#random-password-custom-format input").val();if(0==customFormat.length)return""}for(var str="",i=0;count>i;i++){for(var j=0;len>j;j++)if("alphalc"==format){var char=possibleAlphaLc.charAt(Math.random()*possibleAlphaLc.length);str+=char}else if("alphauc"==format){var char=possibleAlphaUc.charAt(Math.random()*possibleAlphaUc.length);str+=char}else if("alphamix"==format){var char=possibleAlphaMix.charAt(Math.random()*possibleAlphaMix.length);str+=char}else if("alphalcnum"==format){var char=possibleAlphaLcNum.charAt(Math.random()*possibleAlphaLcNum.length);str+=char}else if("alphaucnum"==format){var char=possibleAlphaUcNum.charAt(Math.random()*possibleAlphaUcNum.length);str+=char}else if("alphamixnum"==format){var char=possibleAlphaMixNum.charAt(Math.random()*possibleAlphaMixNum.length);str+=char}else if("num"==format){var char=possibleNum.charAt(Math.random()*possibleNum.length);str+=char}else if("base58"==format){var char=possibleBase58.charAt(Math.random()*possibleBase58.length);str+=char}else if("custom"==format){var char=customFormat.charAt(Math.random()*customFormat.length);str+=char}i!=count-1&&(str+="\n")}return str},{allowEmptyText:!0}),mkTool("random-number",function(){for(var start=parseInt($("#random-number-start").val(),10),end=parseInt($("#random-number-end").val(),10),howMany=parseInt($("#random-number-how-many").val(),10),str="",i=0;howMany>i;i++)str+=parseInt(Math.random()*(end-start+1)+start,10).toString(),i!=howMany-1&&(str+="\n");return str},{allowEmptyText:!0}),mkTool("random-bin",function(){for(var howManyDigits=parseInt($("#random-bin-how-many-digits").val(),10),howManyResuls=parseInt($("#random-bin-how-many-results").val(),10),str="",i=0;howManyResuls>i;i++){for(var res="",j=0;howManyDigits>j;j++){var randByte=parseInt(2*Math.random(),10);
res+=randByte}str+=res,str+="\n"}return str},{allowEmptyText:!0}),mkTool("random-oct",function(){for(var howManyDigits=parseInt($("#random-oct-how-many-digits").val(),10),howManyResuls=parseInt($("#random-oct-how-many-results").val(),10),str="",i=0;howManyResuls>i;i++){for(var res="",j=0;howManyDigits>j;j++){var randByte=parseInt(8*Math.random(),10);res+=randByte}str+=res,str+="\n"}return str},{allowEmptyText:!0}),mkTool("random-dec",function(){for(var howManyDigits=parseInt($("#random-dec-how-many-digits").val(),10),howManyResuls=parseInt($("#random-dec-how-many-results").val(),10),str="",i=0;howManyResuls>i;i++){for(var res="",j=0;howManyDigits>j;j++){var randByte=parseInt(10*Math.random(),10);res+=randByte}str+=res,str+="\n"}return str},{allowEmptyText:!0}),mkTool("random-hex",function(){for(var howManyDigits=parseInt($("#random-hex-how-many-digits").val(),10),howManyResuls=parseInt($("#random-hex-how-many-results").val(),10),str="",i=0;howManyResuls>i;i++){for(var res="",j=0;howManyDigits>j;j++){var randByte=parseInt(16*Math.random(),10).toString(16);res+=randByte}str+=res,str+="\n"}return str},{allowEmptyText:!0}),mkTool("random-fractions",function(){for(var start=parseInt($("#random-fractions-start").val(),10),end=parseInt($("#random-fractions-end").val(),10),howMany=parseInt($("#random-fractions-how-many").val(),10),precision=parseInt($("#random-fractions-precision").val(),10),str="",i=0;howMany>i;i++)str+=(Math.random()*(end-start)+start).toFixed(precision).toString(),i!=howMany-1&&(str+="\n");return str},{allowEmptyText:!0}),$("#random-ip-range").click(function(ev){ev.preventDefault(),$("#random-ip-range-field").slideToggle()}),mkTool("random-ip",function(){function randRange(low,high){return parseInt(parseInt(low,10)+Math.random()*(parseInt(high,10)-parseInt(low,10)+1),10).toString()}for(var howMany=parseInt($("#random-ip-how-many").val(),10),startIp=$('#random-ip-range-field input[name="start"]').val(),endIp=$('#random-ip-range-field input[name="end"]').val(),str="",i=0;howMany>i;i++){var r1=randRange(startIp.split(".")[0],endIp.split(".")[0]),r2=randRange(startIp.split(".")[1],endIp.split(".")[1]),r3=randRange(startIp.split(".")[2],endIp.split(".")[2]),r4=randRange(startIp.split(".")[3],endIp.split(".")[3]);str+=r1+"."+r2+"."+r3+"."+r4,i!=howMany-1&&(str+="\n")}return str},{allowEmptyText:!0}),$("#random-mac-range").click(function(ev){ev.preventDefault(),$("#random-mac-range-field").slideToggle()}),mkTool("random-mac",function(){function randRange(low,high){return parseInt(parseInt(low,16)+Math.random()*(parseInt(high,16)-parseInt(low,16)),16)}for(var howMany=parseInt($("#random-mac-how-many").val(),10),startIp=$('#random-mac-range-field input[name="start"]').val(),endIp=$('#random-mac-range-field input[name="end"]').val(),str="",i=0;howMany>i;i++){var r1=randRange(startIp.split(":")[0],endIp.split(":")[0]).toString(16);r1=parseInt(r1,10).toString(16),1==r1.length&&(r1="0"+r1);var r2=randRange(startIp.split(":")[1],endIp.split(":")[1]).toString(16);r2=parseInt(r2,10).toString(16),1==r2.length&&(r2="0"+r2);var r3=randRange(startIp.split(":")[2],endIp.split(":")[2]).toString(16);r3=parseInt(r3,10).toString(16),1==r3.length&&(r3="0"+r3);var r4=randRange(startIp.split(":")[3],endIp.split(":")[3]).toString(16);r4=parseInt(r4,10).toString(16),1==r4.length&&(r4="0"+r4);var r5=randRange(startIp.split(":")[4],endIp.split(":")[4]).toString(16);r5=parseInt(r5,10).toString(16),1==r5.length&&(r5="0"+r5);var r6=randRange(startIp.split(":")[5],endIp.split(":")[5]).toString(16);r6=parseInt(r6,10).toString(16),1==r6.length&&(r6="0"+r6),str+=r1+":"+r2+":"+r3+":"+r4+":"+r5+":"+r6,i!=howMany-1&&(str+="\n")}return str},{allowEmptyText:!0}),$("#random-date-format").change(function(){var format=$("#random-date-format").val();"custom"==format?$("#random-date-custom-format").slideDown():$("#random-date-custom-format").slideUp()}),$("#random-date-range").click(function(ev){ev.preventDefault(),$("#random-date-range-field").slideToggle()}),mkTool("random-date",function(){var howMany=parseInt($("#random-date-how-many").val(),10),format=$("#random-date-format").val(),startDateStr=$('#random-date-range-field input[name="start"]').val(),endDateStr=$('#random-date-range-field input[name="end"]').val(),startDate=new Date(startDateStr).getTime(),endDate=new Date(endDateStr).getTime();if(isNaN(startDate))var startDate=new Date(1900,0,1).getTime();if(isNaN(endDate))var endDate=new Date(2099,0,31).getTime();for(var str="",i=0;howMany>i;i++){var date=new Date(startDate+Math.random()*(endDate-startDate+1e3)),months_long=["January","February","March","April","May","June","July","August","September","October","November","December"],months_short=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],yyyy=date.getFullYear(),yy=date.getFullYear().toString().substr(2,2),month_long=months_long[date.getMonth()],month_short=months_short[date.getMonth()],mmonth=date.getMonth()+1;10>mmonth&&(mmonth="0"+mmonth.toString());var d=date.getDate(),dd=date.getDate();10>dd&&(dd="0"+dd.toString());var h=date.getHours(),hh=date.getHours();10>hh&&(hh="0"+hh.toString());var m=date.getMinutes(),mminute=date.getMinutes();10>mminute&&(mminute="0"+mminute.toString());var s=date.getSeconds(),ss=date.getSeconds();if(10>ss&&(ss="0"+ss.toString()),"yyyy-mm-dd-hh-mm-ss"==format)str+=[yyyy,mmonth,dd].join("-")+" "+[hh,mminute,ss].join(":");else if("yyyy-dd-mm-hh-mm-ss"==format)str+=[yyyy,dd,mmonth].join("-")+" "+[hh,mminute,ss].join(":");else if("mm-dd-yyyy-hh-mm-ss"==format)str+=[mmonth,dd,yyyy].join("-")+" "+[hh,mminute,ss].join(":");else if("iso8601"==format){var isoStr=date.toISOString();isoStr=isoStr.replace(/\.\d+Z/,"Z"),str+=isoStr}else if("year-month-date-hh-mm-ss"==format)str+=[yyyy,month_long,dd].join(" ")+" "+[hh,mminute,ss].join(":");else if("year-date-month-hh-mm-ss"==format)str+=[yyyy,month_long,dd].join(" ")+" "+[hh,mminute,ss].join(":");else if("month-date-year-hh-mm-ss"==format)str+=[month_long,dd,yyyy].join(" ")+" "+[hh,mminute,ss].join(":");else if("custom"==format){var customFormat=$("#random-date-custom-format input").val(),customStr=customFormat;customStr=customStr.replace("YYYY",yyyy),customStr=customStr.replace("YY",yy),customStr=customStr.replace("MM",mmonth),customStr=customStr.replace("month",month_long),customStr=customStr.replace("mon",month_short),customStr=customStr.replace("DD",dd),customStr=customStr.replace("d",d),customStr=customStr.replace("hh",hh),customStr=customStr.replace("h",h),customStr=customStr.replace("mm",mminute),customStr=customStr.replace("m",m),customStr=customStr.replace("ss",ss),customStr=customStr.replace("s",s),str+=customStr}i!=howMany-1&&(str+="\n")}return str},{allowEmptyText:!0}),$("#random-time-format").change(function(){var format=$("#random-time-format").val();"custom"==format?$("#random-time-custom-format").slideDown():$("#random-time-custom-format").slideUp()}),$("#random-time-range").click(function(ev){ev.preventDefault(),$("#random-time-range-field").slideToggle()}),mkTool("random-time",function(){function randIntRange(start,end){return parseInt(Math.random()*(end-start+1)+start,10).toString()}var howMany=parseInt($("#random-time-how-many").val(),10),format=$("#random-time-format").val(),startTimeStr=$('#random-time-range-field input[name="start"]').val(),endTimeStr=$('#random-time-range-field input[name="end"]').val();if(!/\d+:\d+:\d+/.test(startTimeStr))throw new Error("Invalid start time, doesn't match h:m:s");if(!/\d+:\d+:\d+/.test(endTimeStr))throw new Error("Invalid end time, doesn't match h:m:s");var startTimeH=parseInt(startTimeStr.split(":")[0],10),startTimeM=parseInt(startTimeStr.split(":")[1],10),startTimeS=parseInt(startTimeStr.split(":")[2],10),endTimeH=parseInt(endTimeStr.split(":")[0],10),endTimeM=parseInt(endTimeStr.split(":")[1],10),endTimeS=parseInt(endTimeStr.split(":")[2],10);if(isNaN(startTimeH))throw new Error("Start time hour isn't a valid number");if(isNaN(startTimeM))throw new Error("Start time minute isn't a valid number");if(isNaN(startTimeS))throw new Error("Start time second isn't a valid number");if(isNaN(endTimeH))throw new Error("End time hour isn't a valid number");if(isNaN(endTimeM))throw new Error("End time minute isn't a valid number");if(isNaN(endTimeS))throw new Error("End time second isn't a valid number");if(startTimeH>24)throw new Error("Start time hour bigger than 24");if(startTimeM>60)throw new Error("Start time minute bigger than 60");if(startTimeS>60)throw new Error("Start time second bigger than 60");if(endTimeH>24)throw new Error("End time hour bigger than 24");if(endTimeM>60)throw new Error("End time minute bigger than 60");if(endTimeS>60)throw new Error("End time second bigger than 60");var startSecond=3600*startTimeH+60*startTimeM+startTimeS,endSecond=3600*endTimeH+60*endTimeM+endTimeS;if(startSecond>endSecond)throw new Error("Start time is bigger than end time");for(var str="",i=0;howMany>i;i++){var randSec=randIntRange(startSecond,endSecond),h=parseInt(randSec/3600,10),hh=h;1==hh.toString().length&&(hh="0"+hh);var m=parseInt(randSec%3600/60,10),mm=m;1==mm.toString().length&&(mm="0"+mm);var s=parseInt(randSec%60,10),ss=s;1==ss.toString().length&&(ss="0"+ss);var ampm="am";if(h>=12&&(h-=12,ampm="pm"),"hh-mm-ss"==format)str+=hh+":"+mm+":"+ss;else if("h-m-s"==format)str+=h+":"+m+":"+s;else if("h-m-s-am-pm"==format)str+=h+":"+m+":"+s+" "+ampm;else if("custom"==format){var customFormat=$("#random-time-custom-format input").val(),customStr=customFormat;customStr=customStr.replace("hh",hh),customStr=customStr.replace("h",h),customStr=customStr.replace("mm",mm),customStr=customStr.replace("m",m),customStr=customStr.replace("ss",ss),customStr=customStr.replace("s",s),customStr=customStr.replace("ampm",ampm),str+=customStr}str+="\n"}return str},{allowEmptyText:!0,exceptionFn:function(err){$("#action-error").show(),$("#action-error").text(err)}}),mkTool("prime-numbers",function(){for(var howMany=parseInt($("#prime-numbers-how-many").val(),10),start=parseInt($("#prime-numbers-start").val(),10),primes=[],i=start;;i++){isPrime=!0,upTo=Math.floor(Math.sqrt(i));for(var j=2;j<=upTo;j++)if(i%j==0){isPrime=!1;break}if(isPrime&&(primes.push(i),primes.length>=howMany))break}return primes.join("\n")},{allowEmptyText:!0}),mkTool("fibonacci-numbers",function(){var howMany=parseInt($("#fibonacci-numbers-how-many").val(),10),start=parseInt($("#fibonacci-numbers-start").val(),10),fibs=[],fprev=1,fcur=1,fib=1;for(howMany>1&&1==start&&fibs.push(fprev),howMany>2&&1==start&&fibs.push(fcur);;){if(fibs.length>=howMany)break;fib=fprev+fcur,fprev=fcur,fib>=start&&fibs.push(fib),fcur=fib}return fibs.join("\n")},{allowEmptyText:!0}),mkTool("pi-digits",function(){var howMany=parseInt($("#pi-digits-how-many").val(),10);if(0==howMany)return"3";Decimal.config({precision:howMany+2});for(var zero=new Decimal(0),one=new Decimal(1),two=new Decimal(2),four=new Decimal(4),p16=one,pi=zero,precision=howMany+2,k8=zero,k=zero;k.lte(precision);k=k.plus(one)){var f=four.div(k8.plus(1)).minus(two.div(k8.plus(4))).minus(one.div(k8.plus(5))).minus(one.div(k8.plus(6)));pi=pi.plus(p16.times(f)),p16=p16.div(16),k8=k8.plus(8)}return pi.toString().substr(0,pi.toString().length-1)},{allowEmptyText:!0}),mkTool("e-digits",function(){function factorial(n){if(0==n)return new Decimal(1);for(var result=new Decimal(1),i=new Decimal(1);i.lte(n);i=i.plus(new Decimal(1)))result=result.mul(i);return result}var howMany=parseInt($("#e-digits-how-many").val(),10);if(0==howMany)return"2";Decimal.config({precision:howMany+100});for(var e=new Decimal(1),precision=howMany+100,i=new Decimal(1);i.lte(precision);i=i.plus(new Decimal(1))){var ithTerm=new Decimal(1);ithTerm=ithTerm.div(factorial(i.toFixed())),e=e.plus(ithTerm)}return e.toString().substr(0,howMany+2)},{allowEmptyText:!0}),mkTool("miles-to-km",function(text){for(var lines=text.split("\n"),ret="",i=0;i<lines.length;i++){var line=lines[i],miles=parseFloat(line);if(NaN==miles)ret+=line+"\n";else{var km=1.609344*miles;ret+=km.toFixed(4)+"\n"}}return ret}),mkTool("km-to-miles",function(text){for(var lines=text.split("\n"),ret="",i=0;i<lines.length;i++){var line=lines[i],km=parseFloat(line);if(NaN==km)ret+=line+"\n";else{var miles=km/1.609344;ret+=miles.toFixed(4)+"\n"}}return ret}),mkTool("c-to-f",function(text){for(var lines=text.split("\n"),ret="",i=0;i<lines.length;i++){var line=lines[i],c=parseFloat(line);if(NaN==c)ret+=line+"\n";else{var f=1.8*c+32;ret+=f.toFixed(4)+"\n"}}return ret}),mkTool("f-to-c",function(text){for(var lines=text.split("\n"),ret="",i=0;i<lines.length;i++){var line=lines[i],f=parseFloat(line);if(NaN==f)ret+=line+"\n";else{var c=(f-32)/1.8;ret+=c.toFixed(4)+"\n"}}return ret}),mkTool("deg-to-rad",function(text){for(var lines=text.split("\n"),ret="",i=0;i<lines.length;i++){var line=lines[i],deg=parseFloat(line);if(NaN==deg)ret+=line+"\n";else{var rad=deg*Math.PI/180;ret+=rad.toFixed(4)+"\n"}}return ret}),mkTool("rad-to-deg",function(text){for(var lines=text.split("\n"),ret="",i=0;i<lines.length;i++){var line=lines[i],rad=parseFloat(line);if(NaN==rad)ret+=line+"\n";else{var deg=180*rad/Math.PI;ret+=deg.toFixed(4)+"\n"}}return ret}),mkTool("kg-to-lbs",function(text){for(var lines=text.split("\n"),ret="",i=0;i<lines.length;i++){var line=lines[i],kg=parseFloat(line);if(NaN==kg)ret+=line+"\n";else{var lbs=2.2046226218*kg;ret+=lbs.toFixed(4)+"\n"}}return ret}),mkTool("lbs-to-kg",function(text){for(var lines=text.split("\n"),ret="",i=0;i<lines.length;i++){var line=lines[i],lbs=parseFloat(line);if(NaN==lbs)lbs+=line+"\n";else{var kg=lbs/2.2046226218;ret+=kg.toFixed(4)+"\n"}}return ret}),mkTool("hex-to-rgb",function(text){$("#action-error").hide();for(var lines=text.split("\n"),ret="",i=0;i<lines.length;i++){var line=lines[i];if(0!=line.length){if(line=line.replace(/\s+/g,""),line=line.replace(/^#/,""),3==line.length)var r=line[0].toString()+line[0].toString(),g=line[1].toString()+line[1].toString(),b=line[2].toString()+line[2].toString();else{if(6!=line.length)return $("#action-error").show(),$("#action-error").text("Invalid Hex value. Should be #RRGGBB or #RGB"),text;var r=line[0].toString()+line[1].toString(),g=line[2].toString()+line[3].toString(),b=line[4].toString()+line[5].toString()}var rDec=parseInt(r,16),gDec=parseInt(g,16),bDec=parseInt(b,16);if(isNaN(rDec))return $("#action-error").show(),$("#action-error").text("Invalid RED value"),text;if(isNaN(gDec))return $("#action-error").show(),$("#action-error").text("Invalid GREEN value"),text;if(isNaN(bDec))return $("#action-error").show(),$("#action-error").text("Invalid BLUE value"),text;ret+=lines[i]+" rgb("+rDec+", "+gDec+", "+bDec+")\n"}else ret+="\n"}return ret}),mkTool("rgb-to-hex",function(text){$("#action-error").hide();for(var lines=text.split("\n"),ret="",i=0;i<lines.length;i++){var line=lines[i];if(0!=line.length){line=line.replace(/,/g," "),line=line.replace(/\./g," ");var m=line.match(/(\d+)\s+(\d+)\s+(\d+)/);if(!m)return $("#action-error").show(),$("#action-error").text("Invalid color on line "+(i+1)),text;var r=parseInt(m[1],10),g=parseInt(m[2],10),b=parseInt(m[3],10),rHex=r.toString(16);1==rHex.length&&(rHex="0"+rHex);var gHex=g.toString(16);1==gHex.length&&(gHex="0"+gHex);var bHex=b.toString(16);1==bHex.length&&(bHex="0"+bHex),ret+=lines[i]+" #"+rHex+gHex+bHex+"\n"}else ret+="\n"}return ret}),mkImageConvertTool("jpg-to-png",{inputMime:"image/jpeg",inputHumanFormat:"JPEG"},{outputMime:"image/png",outputExt:"png"},function(){}),mkImageConvertTool("png-to-jpg",{inputMime:"image/png",inputHumanFormat:"PNG"},{outputMime:"image/jpeg",outputExt:"jpg"},function(){}),mkImageConvertTool("gif-to-png",{inputMime:"image/gif",inputHumanFormat:"GIF"},{outputMime:"image/png",outputExt:"png"},function(){}),mkImageConvertTool("gif-to-jpg",{inputMime:"image/gif",inputHumanFormat:"GIF"},{outputMime:"image/jpeg",outputExt:"jpg"},function(){}),mkImageConvertTool("bmp-to-png",{inputMime:"image/bmp",inputHumanFormat:"BMP"},{outputMime:"image/png",outputExt:"png"},function(){}),mkImageConvertTool("bmp-to-jpg",{inputMime:"image/bmp",inputHumanFormat:"BMP"},{outputMime:"image/jpeg",outputExt:"jpg"},function(){}),$("#tool-image-to-base64").length){var selectedFile,fileSelector="#file-select",submitSelector="#submit";$(fileSelector).on("change",function(ev){$("#action-error").hide();var file=ev.target.files[0];selectedFile=file,$(submitSelector).attr("disabled",!1)}),$("#drag-and-drop").on("dragover",function(ev){ev.preventDefault(),ev.stopPropagation(),$("#drag-and-drop").addClass("hover")}),$("#drag-and-drop").on("dragenter",function(ev){ev.preventDefault(),ev.stopPropagation(),$("#drag-and-drop").addClass("hover")}),$("#drag-and-drop").on("dragleave",function(ev){ev.preventDefault(),ev.stopPropagation(),$("#drag-and-drop").removeClass("hover")}),$("#drag-and-drop").on("dragend",function(ev){ev.preventDefault(),ev.stopPropagation(),$("#drag-and-drop").removeClass("hover")}),$("#drag-and-drop").on("drop",function(ev){ev.preventDefault(),ev.stopPropagation(),$("#drag-and-drop").removeClass("hover"),$("#action-error").hide(),ev.dataTransfer=ev.originalEvent.dataTransfer;var file=ev.dataTransfer.files[0];$("#drag-and-drop-selected").text("Selected "+file.name),selectedFile=file,$(submitSelector).attr("disabled",!1)}),$(submitSelector).click(function(){var reader=new FileReader;reader.onload=function(){var comma=reader.result.indexOf(","),base64=reader.result.substr(comma+1);$("#image-to-base64-output textarea").val(base64),$("#image-to-base64-output").slideDown()},reader.readAsDataURL(selectedFile)})}if($("#tool-file-to-base64").length){var selectedFile,fileSelector="#file-select",submitSelector="#submit";$(fileSelector).on("change",function(ev){$("#action-error").hide();var file=ev.target.files[0];selectedFile=file,$(submitSelector).attr("disabled",!1)}),$("#drag-and-drop").on("dragover",function(ev){ev.preventDefault(),ev.stopPropagation(),$("#drag-and-drop").addClass("hover")}),$("#drag-and-drop").on("dragenter",function(ev){ev.preventDefault(),ev.stopPropagation(),$("#drag-and-drop").addClass("hover")}),$("#drag-and-drop").on("dragleave",function(ev){ev.preventDefault(),ev.stopPropagation(),$("#drag-and-drop").removeClass("hover")}),$("#drag-and-drop").on("dragend",function(ev){ev.preventDefault(),ev.stopPropagation(),$("#drag-and-drop").removeClass("hover")}),$("#drag-and-drop").on("drop",function(ev){ev.preventDefault(),ev.stopPropagation(),$("#drag-and-drop").removeClass("hover"),$("#action-error").hide(),ev.dataTransfer=ev.originalEvent.dataTransfer;var file=ev.dataTransfer.files[0];$("#drag-and-drop-selected").text("Selected "+file.name),selectedFile=file,$(submitSelector).attr("disabled",!1)}),$(submitSelector).click(function(){var reader=new FileReader;reader.onload=function(){var comma=reader.result.indexOf(","),base64=reader.result.substr(comma+1);$("#file-to-base64-output textarea").val(base64),$("#file-to-base64-output").slideDown()},reader.readAsDataURL(selectedFile)})}});
